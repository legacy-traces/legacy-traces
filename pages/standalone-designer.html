<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Standalone Print Designer Pro</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.1/fabric.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Roboto:wght@400;700&display=swap"
        rel="stylesheet">
    <style>
        :root {
            --primary: #6366f1;
            --primary-hover: #4f46e5;
            --bg: #0f172a;
            --panel-bg: rgba(30, 41, 59, 0.8);
            --text: #f8fafc;
            --text-muted: #94a3b8;
            --border: rgba(255, 255, 255, 0.1);
            --accent: #c084fc;
        }

        body {
            margin: 0;
            font-family: 'Inter', sans-serif;
            background-color: var(--bg);
            color: var(--text);
            display: flex;
            height: 100vh;
            overflow: hidden;
            box-sizing: border-box;
        }

        /* Sidebar Styles */
        .sidebar {
            width: 340px;
            background: var(--panel-bg);
            backdrop-filter: blur(16px);
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            padding: 20px;
            gap: 16px;
            z-index: 100;
            overflow-y: auto;
            box-sizing: border-box;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: 700;
            background: linear-gradient(to right, #818cf8, var(--accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 8px;
        }

        .section {
            display: flex;
            flex-direction: column;
            gap: 12px;
            padding-bottom: 16px;
            border-bottom: 1px solid var(--border);
        }

        .section-title {
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--text-muted);
        }

        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
        }

        .btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 10px 14px;
            border-radius: 8px;
            font-weight: 600;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn:hover {
            background: var(--primary-hover);
            transform: translateY(-1px);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .btn.active {
            background: var(--primary);
            border-color: var(--accent);
            box-shadow: 0 0 0 2px var(--accent);
        }

        select,
        input[type="text"] {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--border);
            color: white;
            padding: 10px 12px;
            border-radius: 8px;
            outline: none;
            font-size: 0.875rem;
        }

        .color-picker-wrapper {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .color-swatch {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid transparent;
            transition: transform 0.2s;
        }

        .color-swatch:hover {
            transform: scale(1.2);
        }

        .color-swatch.active {
            border-color: white;
        }

        /* Main Content Styles */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
            background: radial-gradient(circle at center, #1e293b 0%, #0f172a 100%);
            overflow: hidden;
        }

        .canvas-outer-container {
            position: relative;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            border-radius: 12px;
            background: white;
            transition: transform 0.3s ease;
            /* Ensure it doesn't block clicks if not intended */
            z-index: 1;
        }

        /* Floating Toolbar - Moved to top to avoid blocking center */
        .top-toolbar {
            position: absolute;
            top: 24px;
            background: var(--panel-bg);
            backdrop-filter: blur(12px);
            border: 1px solid var(--border);
            padding: 8px 16px;
            border-radius: 12px;
            display: flex;
            gap: 16px;
            align-items: center;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.3);
            z-index: 50;
        }

        .zoom-control {
            display: flex;
            align-items: center;
            gap: 12px;
            color: var(--text-muted);
            font-size: 0.875rem;
        }

        input[type="range"] {
            width: 120px;
            accent-color: var(--primary);
        }

        #imageLoader {
            display: none;
        }

        .view-toggle {
            display: flex;
            background: rgba(0, 0, 0, 0.2);
            padding: 4px;
            border-radius: 8px;
            gap: 4px;
        }

        .view-btn {
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 0.75rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .view-btn.active {
            background: var(--primary);
            color: white;
        }

        /* Fix for mouse interaction issue: ensure no invisible overlays */
        .canvas-container {
            margin: 0 auto;
        }
    </style>
</head>

<body>
    <div class="sidebar">
        <div class="logo">Print Designer Pro</div>

        <div class="section">
            <div class="section-title">Product Model</div>
            <div class="grid-2">
                <button id="modelMen" class="btn btn-secondary active" onclick="setModel('men')">Men</button>
                <button id="modelWomen" class="btn btn-secondary" onclick="setModel('women')">Women</button>
            </div>
        </div>

        <div class="section">
            <div class="section-title">T-Shirt Type</div>
            <select id="shirtType" onchange="updateProduct()">
                <option value="round">Round Neck</option>
                <option value="oversized">Oversized</option>
            </select>
        </div>

        <div class="section">
            <div class="section-title">T-Shirt Color</div>
            <div class="color-picker-wrapper">
                <div class="color-swatch active" style="background: #000000;" onclick="setShirtColor('black', this)"
                    title="Black"></div>
                <div class="color-swatch" style="background: #ffffff; border: 1px solid #ccc;"
                    onclick="setShirtColor('white', this)" title="White"></div>
                <div class="color-swatch" style="background: #3b82f6;" onclick="setShirtColor('blue', this)"
                    title="Blue"></div>
                <div class="color-swatch" style="background: #ef4444;" onclick="setShirtColor('red', this)" title="Red">
                </div>
            </div>
        </div>

        <div class="section">
            <div class="section-title">View</div>
            <div class="view-toggle">
                <div id="viewFront" class="view-btn active" onclick="setView('front')">Front</div>
                <div id="viewBack" class="view-btn" onclick="setView('back')">Back</div>
            </div>
        </div>

        <div class="section">
            <div class="section-title">Add Content</div>
            <button class="btn" onclick="addText()">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M4 7V4h16v3M9 20h6M12 4v16" />
                </svg>
                Add Text
            </button>
            <button class="btn btn-secondary" onclick="document.getElementById('imageLoader').click()">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="3" y="3" width="18" height="18" rx="2" ry="2" />
                    <circle cx="8.5" cy="8.5" r="1.5" />
                    <polyline points="21 15 16 10 5 21" />
                </svg>
                Upload Image
            </button>
            <input type="file" id="imageLoader" accept="image/*">
        </div>

        <div id="textControls" class="section" style="display: none;">
            <div class="section-title">Text Properties</div>
            <input type="text" id="textInput" placeholder="Enter text..." oninput="updateText()">
            <select id="fontFamily" onchange="updateFont()">
                <option value="Inter">Inter</option>
                <option value="Roboto">Roboto</option>
                <option value="Arial">Arial</option>
                <option value="Times New Roman">Times New Roman</option>
            </select>
            <div class="color-picker-wrapper">
                <div class="color-swatch active" style="background: #000000;" onclick="setTextColor('#000000', this)">
                </div>
                <div class="color-swatch" style="background: #ffffff; border: 1px solid #ccc;"
                    onclick="setTextColor('#ffffff', this)"></div>
                <div class="color-swatch" style="background: #ef4444;" onclick="setTextColor('#ef4444', this)"></div>
                <div class="color-swatch" style="background: #3b82f6;" onclick="setTextColor('#3b82f6', this)"></div>
                <div class="color-swatch" style="background: #10b981;" onclick="setTextColor('#10b981', this)"></div>
                <div class="color-swatch" style="background: #f59e0b;" onclick="setTextColor('#f59e0b', this)"></div>
            </div>
        </div>

        <div id="objectControls" class="section" style="display: none;">
            <div class="section-title">Object Actions</div>
            <div class="grid-2">
                <button class="btn btn-secondary" onclick="bringToFront()">Front</button>
                <button class="btn btn-secondary" onclick="sendToBack()">Back</button>
                <button class="btn btn-secondary" onclick="flipX()">Flip H</button>
                <button class="btn btn-secondary" onclick="deleteObject()" style="color: #ef4444;">Delete</button>
            </div>
        </div>

        <div style="margin-top: auto;">
            <button class="btn" style="width: 100%;" onclick="downloadDesign()">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
                    <polyline points="7 10 12 15 17 10" />
                    <line x1="12" y1="15" x2="12" y2="3" />
                </svg>
                Download PNG
            </button>
        </div>
    </div>

    <div class="main-content">
        <div class="top-toolbar">
            <div class="zoom-control">
                <span>Zoom</span>
                <input type="range" id="zoomRange" min="0.5" max="2" step="0.1" value="1" oninput="updateZoom()">
                <span id="zoomValue">100%</span>
            </div>
        </div>

        <div class="canvas-outer-container" id="canvasWrapper">
            <canvas id="canvas"></canvas>
        </div>
    </div>

    <script>
        const canvas = new fabric.Canvas('canvas', {
            width: 500,
            height: 600,
            backgroundColor: '#ffffff',
            preserveObjectStacking: true
        });

        let currentModel = 'men';
        let currentView = 'front';
        let currentType = 'round';
        let currentColor = 'black';

        const mockups = {
            men: {
                black: {
                    round: {
                        front: 'T-Shirts/Men/Black T-Shirts/Black-Tshirt-Front.jpg',
                        back: 'T-Shirts/Men/Black T-Shirts/Black-Tshirt-Back.jpg'
                    },
                    oversized: {
                        front: 'T-Shirts/Men/Black T-Shirts/black-Tshirt-oversized-front.png',
                        back: 'T-Shirts/Men/Black T-Shirts/black-Tshirt-oversized-back.png'
                    }
                },
                white: {
                    round: {
                        front: 'T-Shirts/Men/White T-Shirts/white-tshirt-front.jpg',
                        back: 'T-Shirts/Men/White T-Shirts/white-tshirt-back.jpg'
                    },
                    oversized: {
                        front: 'T-Shirts/Men/White T-Shirts/white-Tshirt-oversized-front.png',
                        back: 'T-Shirts/Men/White T-Shirts/white-Tshirt-oversized-back.png'
                    }
                },
                blue: {
                    round: {
                        front: 'T-Shirts/Men/Blue T-Shirts/blue-Tshirt-Front.jpg',
                        back: 'T-Shirts/Men/Blue T-Shirts/blue-Tshirt-Back.jpg'
                    }
                },
                red: {
                    oversized: {
                        front: 'T-Shirts/Men/Red T-Shirt/red-Tshirt-oversized-front.png',
                        back: 'T-Shirts/Men/Red T-Shirt/red-Tshirt-oversized-back.png'
                    }
                }
            },
            women: {
                black: {
                    round: {
                        front: 'T-Shirts/Men/Black T-Shirts/Black-Tshirt-Front.jpg',
                        back: 'T-Shirts/Men/Black T-Shirts/Black-Tshirt-Back.jpg'
                    }
                }
            }
        };

        function updateProduct() {
            currentType = document.getElementById('shirtType').value;

            let url = '';
            if (mockups[currentModel][currentColor] && mockups[currentModel][currentColor][currentType]) {
                url = mockups[currentModel][currentColor][currentType][currentView];
            } else if (mockups[currentModel][currentColor]) {
                const availableTypes = Object.keys(mockups[currentModel][currentColor]);
                if (availableTypes.length > 0) {
                    url = mockups[currentModel][currentColor][availableTypes[0]][currentView];
                }
            }

            if (!url) {
                console.warn("No mockup found for:", currentModel, currentColor, currentType, currentView);
                return;
            }

            fabric.Image.fromURL(url, function (img, isError) {
                if (isError) {
                    console.error("Failed to load image:", url);
                    return;
                }

                const scaleX = canvas.width / img.width;
                const scaleY = canvas.height / img.height;
                const scale = Math.min(scaleX, scaleY);

                img.set({
                    scaleX: scale,
                    scaleY: scale,
                    originX: 'center',
                    originY: 'center',
                    left: canvas.width / 2,
                    top: canvas.height / 2
                });

                canvas.setBackgroundImage(img, canvas.renderAll.bind(canvas));
            });
        }

        function setShirtColor(color, el) {
            currentColor = color;
            document.querySelectorAll('.color-picker-wrapper .color-swatch').forEach(s => s.classList.remove('active'));
            el.classList.add('active');
            updateProduct();
        }

        function setModel(model) {
            currentModel = model;
            document.getElementById('modelMen').classList.toggle('active', model === 'men');
            document.getElementById('modelWomen').classList.toggle('active', model === 'women');
            updateProduct();
        }

        function setView(view) {
            currentView = view;
            document.getElementById('viewFront').classList.toggle('active', view === 'front');
            document.getElementById('viewBack').classList.toggle('active', view === 'back');
            updateProduct();
        }

        function updateZoom() {
            const zoom = document.getElementById('zoomRange').value;
            document.getElementById('zoomValue').innerText = Math.round(zoom * 100) + '%';
            document.getElementById('canvasWrapper').style.transform = `scale(${zoom})`;
        }

        // Selection handling
        canvas.on('selection:created', handleSelection);
        canvas.on('selection:updated', handleSelection);
        canvas.on('selection:cleared', handleSelectionCleared);

        function handleSelection(e) {
            const obj = e.selected[0];
            document.getElementById('objectControls').style.display = 'flex';

            if (obj.type === 'text' || obj.type === 'i-text') {
                document.getElementById('textControls').style.display = 'flex';
                document.getElementById('textInput').value = obj.text;
                document.getElementById('fontFamily').value = obj.fontFamily;
            } else {
                document.getElementById('textControls').style.display = 'none';
            }
        }

        function handleSelectionCleared() {
            document.getElementById('objectControls').style.display = 'none';
            document.getElementById('textControls').style.display = 'none';
        }

        // Actions
        function addText() {
            const text = new fabric.IText('Your Text', {
                left: 150,
                top: 200,
                fontFamily: 'Inter',
                fill: '#000000',
                fontSize: 32,
                textAlign: 'center'
            });
            canvas.add(text);
            canvas.setActiveObject(text);
        }

        function updateText() {
            const obj = canvas.getActiveObject();
            if (obj && (obj.type === 'text' || obj.type === 'i-text')) {
                obj.set('text', document.getElementById('textInput').value);
                canvas.renderAll();
            }
        }

        function updateFont() {
            const obj = canvas.getActiveObject();
            if (obj) {
                obj.set('fontFamily', document.getElementById('fontFamily').value);
                canvas.renderAll();
            }
        }

        function setTextColor(color, el) {
            const obj = canvas.getActiveObject();
            if (obj) {
                obj.set('fill', color);
                canvas.renderAll();
            }
            document.querySelectorAll('.color-swatch').forEach(s => s.classList.remove('active'));
            el.classList.add('active');
        }

        // Image Upload
        document.getElementById('imageLoader').onchange = function (e) {
            const reader = new FileReader();
            reader.onload = function (event) {
                const imgObj = new Image();
                imgObj.src = event.target.result;
                imgObj.onload = function () {
                    const image = new fabric.Image(imgObj);
                    image.scaleToWidth(200);
                    canvas.add(image);
                    canvas.centerObject(image);
                    canvas.setActiveObject(image);
                    canvas.renderAll();
                };
            };
            reader.readAsDataURL(e.target.files[0]);
        };

        // Object Management
        function deleteObject() {
            const obj = canvas.getActiveObject();
            if (obj) {
                canvas.remove(obj);
                canvas.discardActiveObject();
                canvas.renderAll();
            }
        }

        function bringToFront() {
            const obj = canvas.getActiveObject();
            if (obj) {
                obj.bringToFront();
                canvas.renderAll();
            }
        }

        function sendToBack() {
            const obj = canvas.getActiveObject();
            if (obj) {
                obj.sendToBack();
                canvas.renderAll();
            }
        }

        function flipX() {
            const obj = canvas.getActiveObject();
            if (obj) {
                obj.set('flipX', !obj.flipX);
                canvas.renderAll();
            }
        }

        function downloadDesign() {
            try {
                const dataURL = canvas.toDataURL({
                    format: 'png',
                    quality: 1,
                    multiplier: 2
                });
                const link = document.createElement('a');
                link.download = `design-${currentModel}-${currentColor}-${currentType}-${currentView}.png`;
                link.href = dataURL;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            } catch (err) {
                console.error("Download failed: ", err);
                alert("Download failed. Please try again.");
            }
        }

        // Keyboard shortcuts
        window.addEventListener('keydown', (e) => {
            if (e.key === 'Delete' || e.key === 'Backspace') {
                if (document.activeElement.tagName !== 'INPUT') {
                    deleteObject();
                }
            }
        });

        // Initialize
        updateProduct();
    </script>
</body>

</html>